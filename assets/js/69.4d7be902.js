(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{360:function(a,s,t){"use strict";t.r(s);var e=t(13),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"_2-11-6-在-unix-linux-上升级-mysql-二进制或基于包的安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-11-6-在-unix-linux-上升级-mysql-二进制或基于包的安装"}},[a._v("#")]),a._v(" 2.11.6 在 Unix/Linux 上升级 MySQL 二进制或基于包的安装")]),a._v(" "),s("p",[a._v("本节介绍如何在 Unix/Linux 上升级 MySQL 二进制和基于包的安装。描述了就地和逻辑升级方法。")]),a._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#就地升级"}},[a._v("就地升级")])]),s("li",[s("a",{attrs:{href:"#逻辑升级"}},[a._v("逻辑升级")])]),s("li",[s("a",{attrs:{href:"#mysql-集群升级"}},[a._v("MySQL 集群升级")])])])]),s("p"),a._v(" "),s("h2",{attrs:{id:"就地升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#就地升级"}},[a._v("#")]),a._v(" 就地升级")]),a._v(" "),s("p",[a._v("就地升级包括关闭旧的 MySQL 服务器，用新的二进制文件替换旧的 MySQL 二进制文件或包，在现有数据目录上重新启动 MySQL，以及升级需要升级的现有安装的任何剩余部分。有关可能需要升级的内容的详细信息，参阅"),s("RouterLink",{attrs:{to:"/2/2.11/2.11.3/upgrading-what-is-upgraded.html"}},[a._v("章节 2.11.3，“MySQL 升级过程升级的内容”")]),a._v("。")],1),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("如果要升级最初通过安装多个 RPM 软件包生成的安装，请升级所有软件包，而不仅仅是一些。例如，如果以前安装了服务器和客户端 RPM，则不要只升级服务器 RPM。")]),a._v(" "),s("p",[a._v("对于某些 Linux 平台，RPM 或 Debian 包中的 MySQL 安装包括管理 MySQL 服务器启动和关闭的 systemd 支持。在这些平台上，未安装 "),s("RouterLink",{attrs:{to:"/4/4.3/4.3.2/mysqld-safe.html"}},[a._v("mysqld_safe")]),a._v("。在这种情况下，请使用 systemd 来启动和关闭服务器，而不是使用以下说明中使用的方法。参阅"),s("RouterLink",{attrs:{to:"/2/2.5/2.5.9/using-systemd.html"}},[a._v("章节 2.5.9，“使用 systemd 管理 MySQL 服务器”")]),a._v("。")],1),a._v(" "),s("p",[a._v("有关 MySQL 集群安装的升级，参阅 "),s("RouterLink",{attrs:{to:"/2/2.11/2.11.6/upgrade-binary-package.html#MySQL-集群升级"}},[a._v("MySQL 集群升级")]),a._v("。")],1)]),a._v(" "),s("p",[a._v("要执行就地升级，请执行以下操作：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("查看"),s("a",{attrs:{href:"/2/2.11/2.11.1/upgrade-before-you-begin"}},[a._v("章节 2.11.1，“在你开始前”")]),a._v("中的信息。")])]),a._v(" "),s("li",[s("p",[a._v("通过完成"),s("RouterLink",{attrs:{to:"/2/2.11/2.11.5/upgrade-prerequisites.html"}},[a._v("章节 2.11.5，“为升级准备安装”")]),a._v("中的初步检查，确保安装的升级准备就绪。")],1)]),a._v(" "),s("li",[s("p",[a._v("如果将 XA 事务与 "),s("code",[a._v("InnoDB")]),a._v(" 一起使用，请在升级之前运行 "),s("RouterLink",{attrs:{to:"/13/13.3/13.3.8.1/xa-statements.html"}},[a._v("XA RECOVER")]),a._v(" 以检查未提交的 XA 事务。如果返回结果，则通过发出 "),s("RouterLink",{attrs:{to:"/13/13.3/13.3.8.1/xa-statements.html"}},[a._v("XA COMMIT")]),a._v("或 "),s("RouterLink",{attrs:{to:"/13/13.3/13.3.8.1/xa-statements.html"}},[a._v("XA ROLLBACK")]),a._v(" 语句来提交或回滚 XA 事务。")],1)]),a._v(" "),s("li",[s("p",[a._v("如果你要从 MySQL 5.7.11 或更早版本升级到 MySQL 8.0，并且有加密的 "),s("code",[a._v("InnoDB")]),a._v(" 表空间，请执行以下语句来旋转 keyring 主密钥：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("ALTER "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("INSTANCE")]),a._v(" ROTATE INNODB MASTER KEY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("如果你通常运行配置为 "),s("RouterLink",{attrs:{to:"/15/15.14/innodb-parameters.html"}},[a._v("innodb_fast_shutdown")]),a._v("（冷关机）的 MySQL 服务器，请通过执行以下任一语句将其配置为执行快速或慢速关机：")],1),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("SET GLOBAL innodb_fast_shutdown "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" -- fast "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("shutdown")]),a._v("\nSET GLOBAL innodb_fast_shutdown "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" -- slow "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("shutdown")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("无论是快速还是缓慢关闭，"),s("code",[a._v("InnoDB")]),a._v(" 都会将其撤消日志和数据文件保持在一种状态，以便在不同版本之间的文件格式不同时处理。")])]),a._v(" "),s("li",[s("p",[a._v("关闭旧的 MySQL 服务器。例如：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqladmin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("shutdown")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("升级 MySQL 二进制文件或包。如果升级二进制安装，解压缩新的 MySQL 二进制分发包。参阅"),s("RouterLink",{attrs:{to:"/2/2.2/binary-installation.html#获取并打开分发包"}},[a._v("获取并打开分发包")]),a._v("。对于基于软件包的安装，安装新的软件包。")],1)]),a._v(" "),s("li",[s("p",[a._v("使用现有数据目录启动 MySQL 8.0 服务器。例如：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqld_safe "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--datadir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/path/to/existing-datadir "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("如果存在加密的 "),s("code",[a._v("InnoDB")]),a._v(" 表空间，请使用 "),s("RouterLink",{attrs:{to:"/5/5.1/5.1.7/server-options.html"}},[a._v("--early-plugin-load")]),a._v(" 选项加载 keyring 插件。")],1),a._v(" "),s("p",[a._v("当你启动 MySQL 8.0 服务器时，它会自动检测是否存在数据字典表。如果没有，服务器将在数据目录中创建它们，用元数据填充它们，然后继续正常的启动顺序。在此过程中，服务器将升级所有数据库对象的元数据，包括数据库、表空间、系统和用户表、视图以及存储程序（存储过程和函数、触发器和事件调度器事件）。服务器还删除以前用于元数据存储的文件。例如，从 MySQL 5.7 升级到 MySQL 8.0 后，你可能会注意到表不再具有 "),s("code",[a._v(".frm")]),a._v(" 文件。")]),a._v(" "),s("p",[a._v("如果此步骤失败，服务器会将所有更改还原到数据目录。在这种情况下，你应该删除所有重做日志文件，在同一数据目录上启动 MySQL 5.7 服务器，并修复任何错误的原因。然后再次缓慢关闭 5.7 服务器并启动 MySQL 8.0 服务器重试。")])]),a._v(" "),s("li",[s("p",[a._v("在上一步骤中，服务器根据需要升级数据字典。现在需要执行任何剩余的升级操作：")]),a._v(" "),s("p",[a._v("从 MySQL8.0.16 开始，服务器会在上一步中执行此操作，在 MySQL5.7 和 MySQL8.0 之间的 "),s("code",[a._v("mysql")]),a._v(" 系统数据库中进行所需的任何更改，以便你可以利用新的特权或功能。它还更新了 MySQL 8.0 的性能模式、"),s("code",[a._v("INFORMATION_SCHEMA")]),a._v(" 和 "),s("code",[a._v("sys")]),a._v(" 数据库，并检查所有用户数据库是否与当前版本的 MySQL 不兼容。")]),a._v(" "),s("p",[a._v("在 MySQL 8.0.16 之前，服务器在上一步中只升级数据字典。MySQL 8.0 服务器成功启动后，执行 "),s("RouterLink",{attrs:{to:"/4/4.4/4.4.5/mysql-update.html"}},[s("code",[a._v("mysql_upgrade")])]),a._v(" 以执行剩余的升级任务：")],1),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysql_upgrade "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("然后关闭并重新启动 MySQL 服务器，以确保对系统表所做的任何更改都生效。例如：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqladmin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("shutdown")]),a._v("\nmysqld_safe "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--datadir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/path/to/existing-datadir "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("第一次启动 MySQL 8.0 服务器时（在前面的步骤中），你可能会注意到错误日志中有关未升级表的消息。如果 "),s("RouterLink",{attrs:{to:"/4/4.4/4.4.5/mysql-update.html"}},[s("code",[a._v("mysql_upgrade")])]),a._v(" 已经成功运行，那么第二次启动服务器时应该不会出现这样的消息。")],1),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("升级过程不会升级时区表的内容。有关升级说明，请参阅第5.1.15节“MySQL服务器时区支持”。")]),a._v(" "),s("p",[a._v("如果升级过程使用 "),s("RouterLink",{attrs:{to:"/4/4.4/4.4.5/mysql-update.html"}},[s("code",[a._v("mysql_upgrade")])]),a._v("（即 MySQL 8.0.16 之前的版本），那么该过程也不会升级帮助表的内容。有关这种情况下的升级说明，参阅"),s("RouterLink",{attrs:{to:"/5/5.1.17/server-side-help-support.html"}},[a._v("章节 5.1.17，“服务器端帮助支持”")]),a._v("。")],1)])])]),a._v(" "),s("h2",{attrs:{id:"逻辑升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#逻辑升级"}},[a._v("#")]),a._v(" 逻辑升级")]),a._v(" "),s("p",[a._v("逻辑升级包括使用备份或导出实用程序（如 "),s("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[a._v("mysqldump")]),a._v(" 或 "),s("a",{attrs:{href:"/4/4.5/4.5.6/mysqlpump"}},[a._v("mysqlpump")]),a._v(" ）从旧 MySQL 实例导出 SQL，安装新的 MySQL 服务器，并将 SQL 应用到新的 MySQL 实例。有关可能需要升级的内容的详细信息，参阅"),s("RouterLink",{attrs:{to:"/2/2.11/2.11.3/upgrading-what-is-upgraded.html"}},[a._v("章节 2.11.3，“MySQL 升级过程升级的内容”")]),a._v("。")],1),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("对于某些 Linux 平台、RPM 或 Debian 包中的 MySQL 安装包括管理 MySQL 服务器启动和关闭的 systemd 支持。在这些平台上，未安装 "),s("RouterLink",{attrs:{to:"/4/4.3/4.3.2/mysqld-safe.html"}},[a._v("mysqld_safe")]),a._v("。在这种情况下，请使用 systemd 来启动和关闭服务器，而不是使用以下说明中使用的方法。参阅"),s("RouterLink",{attrs:{to:"/2/2.5/2.5.9/using-systemd.html"}},[a._v("章节 2.5.9，“使用 systemd 管理 MySQL 服务器”")]),a._v("。")],1)]),a._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("警告")]),a._v(" "),s("p",[a._v("将从以前的 MySQL 版本中提取的 SQL 应用到新的 MySQL 版本可能会导致错误，因为新的、已更改的、已弃用的或已删除的特性和功能会导致不兼容。因此，从以前的 MySQL 版本中提取的 SQL 可能需要进行修改以实现逻辑升级。")]),a._v(" "),s("p",[a._v("要在升级到最新的 MySQL 8.0 版本之前识别不兼容性，请执行"),s("RouterLink",{attrs:{to:"/2/2.11/2.11.5/2/2.11/2.11.5/upgrade-prerequisites.html"}},[a._v("章节 2.11.5，“准备升级安装”")]),a._v("中描述的步骤。")],1)]),a._v(" "),s("p",[a._v("要执行逻辑升级，请执行以下操作：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("查看"),s("RouterLink",{attrs:{to:"/2/2.11/2.11.1/upgrade-before-you-begin.html"}},[a._v("章节 2.11.1，“在你开始前”")]),a._v("中的信息。")],1)]),a._v(" "),s("li",[s("p",[a._v("从以前的 MySQL 安装导出现有数据：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqldump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n    --add-drop-table "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--routines")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--events")]),a._v("\n    --all-databases "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--force")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" data-for-upgrade.sql\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("如果数据库中包含存储的程序，请在 "),s("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[a._v("mysqldump")]),a._v(" 中使用 "),s("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[a._v("--routines")]),a._v(" 和 "),s("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[a._v("--events")]),a._v(" 选项（如上所示）。"),s("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[a._v("--all-databases")]),a._v(" 选项包括转储中的所有数据库，包括保存系统表的 "),s("code",[a._v("mysql")]),a._v(" 数据库。")],1)]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("重要")]),a._v(" "),s("p",[a._v("如果你的表包含生成的列，请使用 MySQL 5.7.9 或更高版本提供的 "),s("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[a._v("mysqldump")]),a._v(" 实用程序创建转储文件。早期版本中提供的 "),s("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[a._v("mysqldump")]),a._v(" 实用程序对生成的列定义使用了错误的语法（Bug #20769542）。可以使用 "),s("code",[a._v("INFORMATION_SCHEMA.COLUMNS")]),a._v(" 表来标识具有生成列的表。")],1)])]),a._v(" "),s("li",[s("p",[a._v("关闭旧的 MySQL 服务器。例如：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqladmin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("shutdown")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("安装 MySQL 8.0。有关安装说明，参阅"),s("RouterLink",{attrs:{to:"/2/installing.html"}},[a._v("章节 2，安装和升级MySQL")]),a._v("。")],1)]),a._v(" "),s("li",[s("p",[a._v("初始化新的数据目录，如"),s("RouterLink",{attrs:{to:"/2/2.10/2.10.1/data-directory-initialization.html"}},[a._v("章节 2.10.1，“初始化数据目录”")]),a._v("所述。例如：")],1),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqld "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--initialize")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--datadir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/path/to/8.0-datadir\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("将显示在屏幕上的临时 'root'@'localhost' 密码复制到错误日志中，以便以后使用。")])]),a._v(" "),s("li",[s("p",[a._v("使用新的数据目录启动 MySQL 8.0 服务器。例如：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqld_safe "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--datadir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/path/to/8.0-datadir "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("重置 "),s("code",[a._v("root")]),a._v(" 密码：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\nEnter password: ****  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("- enter temporary root password\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ALTER "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" IDENTIFIED BY "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'your new password'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("将先前创建的转储文件加载到新的 MySQL 服务器中。例如：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--force")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" data-for-upgrade.sql\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),s("p",[a._v("如果转储文件包含系统表，建议在服务器上启用 GTID 时（"),s("RouterLink",{attrs:{to:"/17/17.1/17.1.6/17.1.6.5/replication-options-gtids.html"}},[a._v("gtid_mode=ON")]),a._v("）不加载转储文件。"),s("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[a._v("mysqldump")]),a._v(" 为使用非事务性 "),s("code",[a._v("MyISAM")]),a._v(" 存储引擎的系统表发出 DML 指令，并且在启用 GTID 时不允许这种组合。还要注意，将转储文件从启用了 GTID 的服务器加载到另一个启用了 GTID 的服务器，会生成不同的事务标识符。")],1)])]),a._v(" "),s("li",[s("p",[a._v("执行任何剩余的升级操作：")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("在 MySQL 8.0.16 及更高版本中，关闭服务器，然后使用 "),s("RouterLink",{attrs:{to:"/5/5.1/5.1.7/server-options.html"}},[a._v("--upgrade=FORCE")]),a._v(" 选项重新启动服务器，以执行剩余的升级任务：")],1),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqladmin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("shutdown")]),a._v("\nmysqld_safe "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--datadir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/path/to/8.0-datadir "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--upgrade")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("FORCE "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("在使用 "),s("RouterLink",{attrs:{to:"/5/5.1/5.1.7/server-options.html"}},[a._v("--upgrade=FORCE")]),a._v(" 重新启动时，服务器会对 MySQL 5.7 和 MySQL 8.0 之间的 "),s("code",[a._v("mysql")]),a._v(" 系统模式进行任何所需的更改，以便你可以利用新的特权或功能。它还更新了 MySQL 8.0 的性能模式、"),s("code",[a._v("INFORMATION_SCHEMA")]),a._v(" 和 "),s("code",[a._v("sys")]),a._v(" 模式，并检查所有用户模式是否与当前版本的 MySQL 不兼容。")],1)]),a._v(" "),s("li",[s("p",[a._v("在 MySQL 8.0.16 之前，执行 "),s("RouterLink",{attrs:{to:"/4/4.4/4.4.5/mysql-upgrade.html"}},[a._v("mysql_upgrade")]),a._v(" 以执行剩余的升级任务：")],1),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysql_upgrade "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("然后关闭并重新启动 MySQL 服务器，以确保对系统表所做的任何更改都生效。例如：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqladmin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("shutdown")]),a._v("\nmysqld_safe "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--datadir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/path/to/8.0-datadir "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("升级过程不会升级时区表的内容。有关升级说明，参阅"),s("RouterLink",{attrs:{to:"/5/5.1/5.1.15/time-zone-support.html"}},[a._v("章节 5.1.15，“MySQL 服务器时区支持”")]),a._v("。")],1),a._v(" "),s("p",[a._v("如果升级过程使用 "),s("RouterLink",{attrs:{to:"/4/4.4/4.4.5/mysql-upgrade.html"}},[a._v("mysql_upgrade")]),a._v("（即 MySQL 8.0.16 之前的版本），那么该过程也不会升级帮助表的内容。有关这种情况下的升级说明，参阅"),s("RouterLink",{attrs:{to:"/5/5.1/5.1.17/server-side-help-support.html"}},[a._v("章节 5.1.17，“服务器端帮助支持”")]),a._v("。")],1)]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("加载包含 MySQL 5.7 "),s("code",[a._v("mysql")]),a._v(" 模式的转储文件会重新创建两个不再使用的表："),s("code",[a._v("event")]),a._v(" 和 "),s("code",[a._v("proc")]),a._v("。（对应的 MySQL 8.0 表是 "),s("code",[a._v("events")]),a._v(" 和 "),s("code",[a._v("routines")]),a._v("，这两个表都是数据字典表，并且受到保护。）在你确信升级成功后，可以通过执行以下 SQL 语句删除 "),s("code",[a._v("event")]),a._v(" 和 "),s("code",[a._v("proc")]),a._v(" 表：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("DROP TABLE mysql.event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nDROP TABLE mysql.proc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])])]),a._v(" "),s("h2",{attrs:{id:"mysql-集群升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-集群升级"}},[a._v("#")]),a._v(" MySQL 集群升级")]),a._v(" "),s("p",[a._v("本节中的信息是就地升级中描述的就地升级过程的附件，用于升级 MySQL 集群。")]),a._v(" "),s("p",[a._v("从 MySQL 8.0.16 开始，MySQL 集群升级可以作为常规滚动升级执行，遵循通常的三个有序步骤：")]),a._v(" "),s("ol",[s("li",[a._v("升级 MGM 节点。")]),a._v(" "),s("li",[a._v("一次升级一个数据节点。")]),a._v(" "),s("li",[a._v("一次升级一个 API 节点（包括 MySQL 服务器）。")])]),a._v(" "),s("p",[a._v("升级每个节点的方式与 MySQL 8.0.16 之前的几乎相同，因为升级数据字典和升级系统表之间存在分离。升级每个 "),s("code",[a._v("mysqld")]),a._v(" 有两个步骤：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("导入数据字典。")]),a._v(" "),s("p",[a._v("使用 "),s("RouterLink",{attrs:{to:"/5/5.1/5.1.7/server-options.html"}},[a._v("--upgrade=MINIMAL")]),a._v(" 选项启动新服务器，以升级数据字典，但不升级系统表。这与 MySQL 8.0.16 之前的操作基本相同，即启动服务器而不调用 "),s("RouterLink",{attrs:{to:"/4/4.4/4.4.5/mysql-upgrade.html"}},[a._v("mysql_upgrade")]),a._v("。")],1),a._v(" "),s("p",[a._v("MySQL 服务器必须连接到 "),s("code",[a._v("NDB")]),a._v(" 才能完成此阶段。如果存在任何 "),s("code",[a._v("NDB")]),a._v(" 或 "),s("code",[a._v("NDBINFO")]),a._v(" 表，并且服务器无法连接到集群，则会退出并显示错误消息：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("Failed to Populate DD tables.\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("升级系统表。")]),a._v(" "),s("p",[a._v("在 MySQL 8.0.16 之前，DBA 调用 "),s("RouterLink",{attrs:{to:"/4/4.4/4.4.5/mysql-upgrade.html"}},[a._v("mysql_upgrade")]),a._v(" 客户端来升级系统表。从 MySQL 8.0.16 开始，服务器执行以下操作：要升级系统表，重启每个单独的 "),s("RouterLink",{attrs:{to:"/4/4.3/4.3.1/mysqld.html"}},[a._v("mysqld")]),a._v("，而不使用 "),s("RouterLink",{attrs:{to:"/5/5.1/5.1.7/server-options.html"}},[a._v("--upgrade=MINIMAL")]),a._v(" 选项。")],1)])]),a._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/upgrade-binary-package.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("原文链接"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);