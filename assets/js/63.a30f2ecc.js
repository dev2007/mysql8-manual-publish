(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{419:function(t,a,s){"use strict";s.r(a);var e=s(13),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_2-11-13-重建或修复表或索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-11-13-重建或修复表或索引"}},[t._v("#")]),t._v(" 2.11.13 重建或修复表或索引")]),t._v(" "),a("p",[t._v("本节介绍如何重建或修复表或索引，这可能是以下情况所必需的：")]),t._v(" "),a("ul",[a("li",[t._v("更改 MySQL 处理数据类型或字符集的方式。例如，排序规则中的错误可能已更正，因此需要重新生成表以更新使用排序规则的字符列的索引。")]),t._v(" "),a("li",[a("RouterLink",{attrs:{to:"/13/13.7/13.7.3/13.7.3.2/check-table.html"}},[t._v("CHECK TABLE")]),t._v("、"),a("RouterLink",{attrs:{to:"/4/4.5/4.5.3/mysqlcheck.html"}},[t._v("mysqlcheck")]),t._v(" 或 "),a("RouterLink",{attrs:{to:"/4/4.4/4.4.5/mysql-upgrade.html"}},[t._v("mysql_upgrade")]),t._v(" 报告的所需表修复或升级。")],1)]),t._v(" "),a("p",[t._v("重建表的方法包括：")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#转储和重新加载方法"}},[t._v("转储和重新加载方法")])]),a("li",[a("a",{attrs:{href:"#alter-table-方法"}},[t._v("ALTER TABLE 方法")])]),a("li",[a("a",{attrs:{href:"#repair-table-方法"}},[t._v("REPAIR TABLE 方法")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"转储和重新加载方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#转储和重新加载方法"}},[t._v("#")]),t._v(" 转储和重新加载方法")]),t._v(" "),a("p",[t._v("如果你正在重建表，因为在二进制（就地）升级或降级后，不同版本的 MySQL 无法处理它们，则必须使用转储和重新加载方法。在使用 MySQL 的原始版本升级或降级"),a("em",[t._v("之前")]),t._v("转储表。然后在升级或降级"),a("em",[t._v("之后")]),t._v("重新加载表。")]),t._v(" "),a("p",[t._v("如果仅为了重建索引而使用转储和重新加载方法来重建表，则可以在升级或降级之前或之后执行转储。之后仍必须重新加载。")]),t._v(" "),a("p",[t._v("如果你需要重建 "),a("code",[t._v("InnoDB")]),t._v(" 表，因为 "),a("RouterLink",{attrs:{to:"/13/13.7/13.7.3/13.7.3.2/check-table.html"}},[t._v("CHECK TABLE")]),t._v(" 操作指示需要升级表，请使用 "),a("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[t._v("mysqldump")]),t._v(" 创建转储文件，使用 "),a("RouterLink",{attrs:{to:"/4/4.5/4.5.1/mysql.html"}},[t._v("mysql")]),t._v(" 重新加载该文件。如果 "),a("RouterLink",{attrs:{to:"/13/13.7/13.7.3/13.7.3.2/check-table.html"}},[t._v("CHECK TABLE")]),t._v(" 操作指示存在损坏或导致 "),a("code",[t._v("InnoDB")]),t._v(" 失败，参阅"),a("RouterLink",{attrs:{to:"/15/15.21/15.21.3/forcing-innodb-recovery.html"}},[t._v("章节 15.21.3，“强制 InnoDB 恢复”")]),t._v("，了解有关使用InnoDB_force_Recovery选项重新启动InnoDB的信息。要了解 "),a("RouterLink",{attrs:{to:"/13/13.7/13.7.3/13.7.3.2/check-table.html"}},[t._v("CHECK TABLE")]),t._v(" 可能遇到的问题类型，参阅"),a("RouterLink",{attrs:{to:"/13/13.7/13.7.3/13.7.3.2/check-table.html"}},[t._v("章节 13.7.3.2，“CHECK TABLE 语句”")]),t._v("中的 "),a("code",[t._v("InnoDB")]),t._v(" 注释。")],1),t._v(" "),a("p",[t._v("要通过转储和重新加载来重建表，请使用 "),a("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[t._v("mysqldump")]),t._v(" 创建转储文件，使用 "),a("RouterLink",{attrs:{to:"/4/4.5/4.5.1/mysql.html"}},[t._v("mysql")]),t._v(" 重新加载文件：")],1),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("mysqldump db_name t1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" dump.sql\nmysql db_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" dump.sql\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("要在单个数据库中重建所有表，请指定数据库名称，但不指定以下任何表名称：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("mysqldump db_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" dump.sql\nmysql db_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" dump.sql\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("要重建所有数据库中的所有表，请使用 "),a("RouterLink",{attrs:{to:"/4/4.5/4.5.4/mysqldump.html"}},[t._v("--all-databases")]),t._v(" 选项：")],1),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("mysqldump --all-databases "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" dump.sql\nmysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" dump.sql\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h2",{attrs:{id:"alter-table-方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alter-table-方法"}},[t._v("#")]),t._v(" ALTER TABLE 方法")]),t._v(" "),a("p",[t._v("要使用 "),a("RouterLink",{attrs:{to:"/13/13.1/13.1.9/alter-table.html"}},[t._v("ALTER TABLE")]),t._v(" 重建表，请使用 “null” 更改；也就是说，"),a("RouterLink",{attrs:{to:"/13/13.1/13.1.9/alter-table.html"}},[t._v("ALTER TABLE")]),t._v(" 语句“更改”表以使用它已经拥有的存储引擎。例如，如果 "),a("code",[t._v("t1")]),t._v(" 是 "),a("code",[t._v("InnoDB")]),t._v(" 表，请使用以下语句：")],1),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ALTER TABLE t1 ENGINE "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" InnoDB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("如果不确定要在 "),a("RouterLink",{attrs:{to:"/13/13.1/13.1.9/alter-table.html"}},[t._v("ALTER TABLE")]),t._v(" 语句中指定哪个存储引擎，请使用 "),a("RouterLink",{attrs:{to:"/13/13.7/13.7.7/13.7.7.10/show-create-table.html"}},[t._v("SHOW CREATE TABLE")]),t._v(" 显示表定义。")],1),t._v(" "),a("h2",{attrs:{id:"repair-table-方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#repair-table-方法"}},[t._v("#")]),t._v(" REPAIR TABLE 方法")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/13/13.7/13.7.3/13.7.3.5/repair-table.html"}},[t._v("REPAIR TABLE")]),t._v(" 方法仅适用于 "),a("code",[t._v("MyISAM")]),t._v("、"),a("code",[t._v("ARCHIVE")]),t._v(" 和 "),a("code",[t._v("CSV")]),t._v(" 表。")],1),t._v(" "),a("p",[t._v("如果表检查操作指示存在损坏或需要升级，则可以使用 "),a("RouterLink",{attrs:{to:"/13/13.7/13.7.3/13.7.3.5/repair-table.html"}},[t._v("REPAIR TABLE")]),t._v("。例如，要修复 "),a("code",[t._v("MyISAM")]),t._v(" 表，请使用以下语句：")],1),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("REPAIR TABLE t1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("RouterLink",{attrs:{to:"/4/4.5/4.5.3/mysqlcheck.html"}},[t._v("mysqlcheck --repair")]),t._v(" 提供对 "),a("RouterLink",{attrs:{to:"/13/13.7/13.7.3/13.7.3.5/repair-table.html"}},[t._v("REPAIR TABLE")]),t._v(" 语句的命令行访问。这可能是一种更方便的修复表的方法，因为你可以使用 [--databases]((/4/4.5/4.5.3/mysqlcheck.html) 或 [--all-databases]((/4/4.5/4.5.3/mysqlcheck.html) 选项分别修复特定数据库或所有数据库中的所有表：")],1),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("mysqlcheck "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--repair")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--databases")]),t._v(" db_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nmysqlcheck "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--repair")]),t._v(" --all-databases\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("blockquote",[a("p",[a("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/rebuilding-tables.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文链接"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);