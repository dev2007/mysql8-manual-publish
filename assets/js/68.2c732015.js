(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{359:function(s,t,a){"use strict";a.r(t);var n=a(13),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_2-11-5-准备升级安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-11-5-准备升级安装"}},[s._v("#")]),s._v(" 2.11.5 准备升级安装")]),s._v(" "),t("p",[s._v("在升级到最新的 MySQL 8.0 版本之前，通过执行以下初步检查，确保当前 MySQL 5.7 或 MySQL 8.0 服务器实例的升级准备就绪。否则，升级过程可能会失败。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("考虑使用 "),t("a",{attrs:{href:"https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-utilities-upgrade.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL Shell 升级检查器实用程序"),t("OutboundLink")],1),s._v("，该实用程序使你能够验证 MySQL 服务器实例是否已准备好升级。你可以选择计划升级到的目标 MySQL Server 版本，范围从 MySQL 服务器 8.0.11 到与当前 MySQL Shell 版本号匹配的 MySQL 服务器版本号。升级检查器实用程序执行与指定目标版本相关的自动检查，并建议你手动进行进一步的相关检查。升级检查器适用于 MySQL 5.7 和 8.0 的所有 GA 版本。MySQL Shell 的安装说明可在"),t("a",{attrs:{href:"https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-install.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("此处"),t("OutboundLink")],1),s._v("找到。")])]),s._v(" "),t("p",[s._v("初步检查：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("不得出现以下问题：")]),s._v(" "),t("ul",[t("li",[s._v("不能有使用过时数据类型或函数的表。")]),s._v(" "),t("li",[s._v("如果表包含 5.6.4 之前格式的旧时间列（"),t("RouterLink",{attrs:{to:"/11/11.2/11.2.3/time.html"}},[t("code",[s._v("TIME")])]),s._v("、"),t("RouterLink",{attrs:{to:"/11/11.2/11.2.2/datetime.html"}},[t("code",[s._v("DATETIME")])]),s._v(" 和 "),t("RouterLink",{attrs:{to:"/11/11.2/11.2.2/datetime.html"}},[t("code",[s._v("TIMESTAMP")])]),s._v(" 列不支持小数秒精度），则不支持就地升级到 MySQL 8.0。如果你的表仍然使用旧的时间列格式，请在尝试就地升级到 MySQL 8.0 之前使用 "),t("RouterLink",{attrs:{to:"/13/13.7/13.7.3/13.7.3.5/repair-table.html"}},[s._v("REPAIR TABLE")]),s._v(" 对其进行升级。有关更多信息，参阅 "),t("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL 5.7参考手册"),t("OutboundLink")],1),s._v("中的"),t("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/upgrading-from-previous-series.html#upgrade-server-changes",target:"_blank",rel:"noopener noreferrer"}},[s._v("服务器变更"),t("OutboundLink")],1),s._v("。")],1),s._v(" "),t("li",[s._v("必须没有孤立的 "),t("code",[s._v(".frm")]),s._v(" 文件。")]),s._v(" "),t("li",[s._v("触发器不能有丢失的或空的定义符或无效的创建上下文（由 "),t("RouterLink",{attrs:{to:"/13/13.7/13.7.7/13.7.7.40/show-triggers.html"}},[s._v("SHOW TRIGGERS")]),s._v(" 或 "),t("code",[s._v("INFORMATION_SCHEMA")]),s._v(" "),t("RouterLink",{attrs:{to:"/26/26.3/26.3.45/information-schema-triggers-table.html"}},[s._v("TRIGGERS")]),s._v(" 表显示的"),t("code",[s._v("character_set_client")]),s._v("、"),t("code",[s._v("collation_connection")]),s._v("、"),t("code",[s._v("Database Collation")]),s._v(" 属性指示）。必须转储和恢复任何此类触发器以解决问题。")],1)]),s._v(" "),t("p",[s._v("要检查这些问题，请执行以下命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysqlcheck "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" --all-databases --check-upgrade\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果 "),t("RouterLink",{attrs:{to:"/4/4.5/4.5.3/mysqlcheck.html"}},[s._v("mysqlcheck")]),s._v(" 报告任何错误，请更正问题。")],1)]),s._v(" "),t("li",[t("p",[s._v("不能有使用不支持本机分区的存储引擎的分区表。要标识此类表，请执行以下查询：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SELECT TABLE_SCHEMA, TABLE_NAME\nFROM INFORMATION_SCHEMA.TABLES\nWHERE ENGINE NOT IN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'innodb'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ndbcluster'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nAND CREATE_OPTIONS LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%partitioned%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("查询所报告的任何表都必须更改为使用 "),t("code",[s._v("InnoDB")]),s._v(" 或不分区。要将表存储引擎更改为InnoDB，请执行以下语句：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ALTER TABLE table_name ENGINE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" INNODB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("有关将 "),t("code",[s._v("MyISAM")]),s._v(" 表转换为 "),t("code",[s._v("InnoDB")]),s._v(" 的信息，参阅"),t("RouterLink",{attrs:{to:"/15/15.6/15.6.1/15.6.1.5/converting-tables-to-innodb.html"}},[s._v("章节 15.6.1.5，“将表从 MyISAM 转换为 InnoDB”")]),s._v("。")],1),s._v(" "),t("p",[s._v("要使分区表不分区，请执行以下语句：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ALTER TABLE table_name REMOVE PARTITIONING"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("MySQL 8.0 中可能保留了一些以前未保留的关键字。参阅"),t("RouterLink",{attrs:{to:"/9/9.3/keywords.html"}},[s._v("章节 9.3，“关键词和保留词”")]),s._v("。这可能会导致以前用作标识符的单词变得非法。要修复受影响的语句，请使用标识符引号。参阅"),t("RouterLink",{attrs:{to:"/9/9.2/identifiers.html"}},[s._v("章节 9.2，“模式对象名称”")]),s._v("。")],1)]),s._v(" "),t("li",[t("p",[s._v("MySQL 5.7 "),t("code",[s._v("mysql")]),s._v(" 系统数据库中不能有与 MySQL 8.0 数据字典使用的表同名的表。要标识具有这些名称的表，请执行以下查询：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SELECT TABLE_SCHEMA, TABLE_NAME\nFROM INFORMATION_SCHEMA.TABLES\nWHERE LOWER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TABLE_SCHEMA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),s._v("\nand LOWER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TABLE_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" IN\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'catalogs'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'character_sets'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'check_constraints'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'collations'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'column_statistics'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'column_type_elements'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'columns'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dd_properties'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'events'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'foreign_key_column_usage'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'foreign_keys'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'index_column_usage'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'index_partitions'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'index_stats'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'indexes'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'parameter_type_elements'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'parameters'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'resource_groups'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'routines'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'schemata'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'st_spatial_reference_systems'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table_partition_values'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table_partitions'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table_stats'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tables'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tablespace_files'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tablespaces'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'triggers'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'view_routine_usage'")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'view_table_usage'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("必须删除或重命名查询报告的任何表（使用 "),t("RouterLink",{attrs:{to:"/13/13.1/13.1.36/rename-table.html"}},[s._v("RENAME TABLE")]),s._v("）。这还可能需要更改使用受影响表的应用程序。")],1)]),s._v(" "),t("li",[t("p",[s._v("不能有外键约束名称超过 64 个字符的表。使用此查询可标识约束名称过长的表：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SELECT TABLE_SCHEMA, TABLE_NAME\nFROM INFORMATION_SCHEMA.TABLES\nWHERE TABLE_NAME IN\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SELECT LEFT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SUBSTR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID,INSTR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n            INSTR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SUBSTR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID,INSTR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'_ibfk_'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nFROM INFORMATION_SCHEMA.INNODB_SYS_FOREIGN\nWHERE LENGTH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SUBSTR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID,INSTR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("对于约束名称超过 64 个字符的表，请删除约束并将其添加回不超过 64 个的约束名称（使用 "),t("RouterLink",{attrs:{to:"/13/13.1/13.1.9/alter-table.html"}},[t("code",[s._v("ALTER TABLE")])]),s._v("）。")],1)]),s._v(" "),t("li",[t("p",[t("RouterLink",{attrs:{to:"/5/5.1/5.1.8/server-system-variables.html"}},[s._v("sql_mode")]),s._v(" 系统变量不能定义过时的 SQL 模式。尝试使用过时的 SQL 模式会阻止 MySQL 8.0 启动。应修改使用过时 SQL 模式的应用程序以避免它们。有关 MySQL 8.0 中删除的 SQL 模式的信息，参阅"),t("RouterLink",{attrs:{to:"/2/2.11/2.11.4/upgrading-from-previous-series.html#服务器变更"}},[s._v("服务器变更")]),s._v("。")],1)]),s._v(" "),t("li",[t("p",[s._v("任何视图的显式定义列名不得超过 64 个字符（MySQL 5.7 中允许列名最多为 255 个字符的视图）。为避免升级错误，应在升级前更改此类视图。目前，识别列名超过 64 个字符的视图的唯一方法是使用 "),t("RouterLink",{attrs:{to:"/13/13.7/13.7.13/show-create-view.html"}},[s._v("SHOW CREATE VIEW")]),s._v(" 检查视图定义。还可以通过查询 "),t("RouterLink",{attrs:{to:"/26/26.3/26.3.48/information-schema-views-table.html"}},[s._v("INFORMATION_SCHEMA.VIEWS")]),s._v(" 表来检查视图定义。")],1)]),s._v(" "),t("li",[t("p",[s._v("任何表或存储过程的单个 "),t("code",[s._v("ENUM")]),s._v(" 或 "),t("code",[s._v("SET")]),s._v(" 列元素的长度不得超过 255 个字符或 1020 个字节。在 MySQL 8.0 之前，"),t("code",[s._v("ENUM")]),s._v(" 或 "),t("code",[s._v("SET")]),s._v(" 列元素的最大组合长度为 64K。在 MySQL 8.0 中，单个 "),t("code",[s._v("ENUM")]),s._v(" 或 "),t("code",[s._v("SET")]),s._v(" 列元素的最大字符长度为 255 个字符，最大字节长度为 1020 个字节。（1020 字节限制支持多字节字符集）。升级到 MySQL 8.0 之前，请修改超过新限制的任何 "),t("code",[s._v("ENUM")]),s._v(" 或 "),t("code",[s._v("SET")]),s._v(" 列元素。否则将导致升级失败并出现错误。")])]),s._v(" "),t("li",[t("p",[s._v("在升级到 MySQL 8.0.13 或更高版本之前，共享的 "),t("code",[s._v("InnoDB")]),s._v(" 表空间中必须没有表分区，其中包括系统表空间和通用表空间。通过查询 "),t("code",[s._v("INFORMATION_SCHEMA")]),s._v(" 标识共享表空间中的表分区：")]),s._v(" "),t("p",[s._v("如果从MySQL 5.7升级，请运行以下查询：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SELECT DISTINCT NAME, SPACE, SPACE_TYPE FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES\nWHERE NAME LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%#P#%'")]),s._v(" AND SPACE_TYPE NOT LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Single'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("如果从早期的 MySQL 8.0 版本升级，请运行以下查询：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SELECT DISTINCT NAME, SPACE, SPACE_TYPE FROM INFORMATION_SCHEMA.INNODB_TABLES\n    WHERE NAME LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%#P#%'")]),s._v(" AND SPACE_TYPE NOT LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Single'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("使用 "),t("RouterLink",{attrs:{to:"/13/13.1/13.1.9/alter-table.html"}},[s._v("ALTER TABLE ... REORGANIZE PARTITION")]),s._v(" 将表分区从共享表空间移动到每个表的文件表空间：")],1),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ALTER TABLE table_name REORGANIZE PARTITION partition_name\n    INTO "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("partition_definition "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TABLESPACE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("innodb_file_per_table"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("MySQL 8.0.12 或更低版本中的查询和存储程序定义不能对 "),t("code",[s._v("GROUP BY")]),s._v(" 子句使用 "),t("code",[s._v("ASC")]),s._v(" 或 "),t("code",[s._v("DESC")]),s._v(" 限定符。否则，升级到 MySQL 8.0.13 或更高版本可能会失败，复制到 MySQL 8.0-13 或更高副本服务器也可能会失败。有关其他详细信息，参阅"),t("RouterLink",{attrs:{to:"/2/2.11/2.11.4/upgrading-from-previous-series.html#SQL-变更"}},[s._v("SQL 变更")]),s._v("。")],1)]),s._v(" "),t("li",[t("p",[s._v("你的 MySQL 5.7 安装不得使用 MySQL 8.0 不支持的功能。此处的任何更改都必须是特定于安装的，但以下示例说明了需要查找的内容：")]),s._v(" "),t("p",[s._v("MySQL 8.0 中删除了一些服务器启动选项和系统变量。参阅 "),t("RouterLink",{attrs:{to:"/1/1.3/mysql-nutshell.html#mysql-8-0-弃用特性"}},[s._v("MySQL 8.0 中删除的特性")]),s._v("，以及"),t("RouterLink",{attrs:{to:"/1/1.4/added-deprecated-removed.html"}},[s._v("章节 1.4，“MySQL 8.0 中添加的、不推荐的或删除的服务器和状态变量和选项”")]),s._v("。如果你使用这些功能，升级需要更改配置。")],1),s._v(" "),t("p",[s._v("示例：因为数据字典提供有关数据库对象的信息，所以服务器不再检查数据目录中的目录名以查找数据库。因此，"),t("code",[s._v("--ignore-db-dir")]),s._v(" 选项是多余的，已被删除。要处理此问题，请从启动配置中删除 "),t("code",[s._v("--ignore-db-dir")]),s._v(" 的所有实例。此外，在升级到 MySQL 8.0 之前，请删除或移动已命名的数据目录子目录。（或者，让 8.0 服务器将这些目录作为数据库添加到数据字典中，然后使用 "),t("RouterLink",{attrs:{to:"/13/13.1/13.1.24/drop-database.html"}},[s._v("DROP DATABASE")]),s._v(" 删除每个数据库。）")],1)]),s._v(" "),t("li",[t("p",[s._v("如果你打算在升级时将 "),t("RouterLink",{attrs:{to:"/5/5.1/5.1.8/server-system-variables.html"}},[s._v("lower_case_table_names")]),s._v(" 设置更改为 "),t("code",[s._v("1")]),s._v("，请确保模式和表名在升级前为小写。否则，可能会由于架构或表名字母大小写不匹配而发生故障。可以使用以下查询检查包含大写字符的架构和表名：")],1),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" TABLE_NAME, if"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sha"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TABLE_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v("sha"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lower"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TABLE_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Yes'")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'No'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" as UpperCase from information_schema.tables"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("从 MySQL 8.0.19 开始，如果 "),t("RouterLink",{attrs:{to:"/5/5.1/5.1.8/server-system-variables.html"}},[s._v("lower_case_table_names=1")]),s._v("，升级过程将检查表和模式名称，以确保所有字符都是小写的。如果发现表或架构名称包含大写字符，则升级过程将失败并出现错误。")],1),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("不建议在升级时更改 "),t("RouterLink",{attrs:{to:"/5/5.1/5.1.8/server-system-variables.html"}},[s._v("lower_case_table_names")]),s._v(" 设置。")],1)])])]),s._v(" "),t("p",[s._v("如果由于上述任何问题导致升级到 MySQL 8.0 失败，服务器会将所有更改还原到数据目录。在这种情况下，删除所有重做日志文件，并在现有数据目录上重新启动 MySQL 5.7 服务器以解决错误。默认情况下，重做日志文件（"),t("code",[s._v("ib_logfile*")]),s._v("）位于 MySQL 数据目录中。修复错误后，在再次尝试升级之前，执行缓慢关闭（通过设置 "),t("RouterLink",{attrs:{to:"/2/2.11/2.11.5/innodb-parameters.html"}},[s._v("innodb_fast_shutdown=0")]),s._v("）。")],1),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/upgrade-prerequisites.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);