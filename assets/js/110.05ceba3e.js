(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{409:function(s,e,a){"use strict";a.r(e);var t=a(13),r=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"_2-5-9-使用-systemd-管理-mysql-服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-9-使用-systemd-管理-mysql-服务器"}},[s._v("#")]),s._v(" 2.5.9 使用 systemd 管理 MySQL 服务器")]),s._v(" "),e("p",[s._v("如果在以下 Linux 平台上使用 RPM 或 Debian 软件包安装 MySQL，服务器启动和关闭由 systemd 管理：")]),s._v(" "),e("ul",[e("li",[s._v("RPM 包平台：\n"),e("ul",[e("li",[s._v("企业版 Linux 变体版本7及更高版本")]),s._v(" "),e("li",[s._v("SUSE Linux 企业版服务器 12 及更高版本")]),s._v(" "),e("li",[s._v("Fedora 29 及以上")])])]),s._v(" "),e("li",[s._v("Debian 系列平台：\n"),e("ul",[e("li",[s._v("Debian 平台")]),s._v(" "),e("li",[s._v("Ubuntu 平台")])])])]),s._v(" "),e("p",[s._v("如果在使用 systemd 的平台上从通用二进制发行版安装 MySQL，则可以按照 "),e("a",{attrs:{href:"https://dev.mysql.com/doc/mysql-secure-deployment-guide/8.0/en/",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL 8.0 安全部署指南"),e("OutboundLink")],1),s._v("的安装后设置部分中提供的说明手动配置对 MySQL 的 systemd 支持。")]),s._v(" "),e("p",[s._v("如果在使用 systemd 的平台上从源发行版安装 MySQL，请通过使用 "),e("a",{attrs:{href:"/2/2.9/2.9.7/source-configuration-options"}},[s._v("-DWITH_SYSTEMD=1")]),s._v(" "),e("strong",[s._v("CMake")]),s._v(" 选项配置发行版来获得对 MySQL 的 systemd 支持。参阅"),e("a",{attrs:{href:"/2/2.9/2.9.7/source-configuration-options"}},[s._v("章节 2.9.7，“MySQL 源配置选项”")]),s._v("。")]),s._v(" "),e("p",[s._v("以下讨论涵盖了这些主题：")]),s._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/2/2.5/2.5.9/using-systemd.html#systemd-概览"}},[s._v("systemd 概览")])],1),s._v(" "),e("li",[e("RouterLink",{attrs:{to:"/2/2.5/2.5.9/using-systemd.html#为-mysql-配置-systemd"}},[s._v("为 MySQL 配置 systemd")])],1),s._v(" "),e("li",[e("RouterLink",{attrs:{to:"/2/2.5/2.5.9/using-systemd.html#使用-systemd-配置多个-mysql-实例"}},[s._v("使用 systemd 配置多个 MySQL 实例")])],1),s._v(" "),e("li",[e("RouterLink",{attrs:{to:"/2/2.5/2.5.9/using-systemd.html#从-mysqld-safe-迁移到-systemd"}},[s._v("从 mysqld_safe 迁移到 systemd")])],1)]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("在安装了 MySQL 版的 systemd 支持的平台上，诸如 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 和 System V 初始化这类脚本是非必需的，且也没有安装。例如，mysqld_safe可以处理服务器重启，但 systemd 提供了相同的功能，并以与其他服务的管理一致的方式进行，而不是使用特定于应用程序的程序。\n在使用 systemd 进行服务器管理的平台上不使用 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 的一个暗示是，不支持在选项文件中使用 "),e("code",[s._v("[mysqld_safe]")]),s._v(" 或 "),e("code",[s._v("[safe_mysqld]")]),s._v(" 部分，这可能会导致意外行为。\n因为 systemd 能够在安装了 MySQL 版的 systemd 支持的平台上管理多个 MySQL 实例，即 "),e("a",{attrs:{href:"/4/4.3/4.3.4/mysqld-multi"}},[s._v("mysqld_multi")]),s._v("和 "),e("strong",[s._v("mysqld_multi.server")]),s._v(" 是不必要的，并且没有安装。")])]),s._v(" "),e("h2",{attrs:{id:"systemd-概览"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#systemd-概览"}},[s._v("#")]),s._v(" systemd 概览")]),s._v(" "),e("p",[s._v("systemd 提供 MySQL 服务器的自动启动和关闭。它还使用 systemctl 命令启用手动服务器管理。例如：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" systemctl "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("start"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("stop"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" mysqld\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("或者，使用与 System V 系统兼容的 service 命令（参数反转）：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysqld "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("start"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("stop"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("对于 systemctl 命令（以及备用 "),e("strong",[s._v("service")]),s._v(" 命令），如果 MySQL 服务名称不是 mysqld，则使用适当的名称。例如，在基于 Debian 和 SLES 系统上使用 "),e("code",[s._v("mysql")]),s._v(" 而不是 "),e("code",[s._v("mysqld")]),s._v("。")])]),s._v(" "),e("p",[s._v("对 systemd 的支持包括以下文件：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("mysqld.service")]),s._v("（RPM 平台）、"),e("code",[s._v("mysql.service")]),s._v("（Debian 平台）：systemd 服务单元配置文件，包含 MySQL 服务的详细信息。")]),s._v(" "),e("li",[e("code",[s._v("mysqld@.service")]),s._v("（RPM 平台），"),e("code",[s._v("mysql@.service")]),s._v("（Debian 平台）：比如 mysqld.service 或 mysql.service，但用于管理多个 MySQL 实例。")]),s._v(" "),e("li",[e("code",[s._v("mysqld.tmpfiles.d")]),s._v("： 包含支持 "),e("code",[s._v("tmpfiles")]),s._v(" 功能的信息的文件。此文件以名称 "),e("code",[s._v("mysql.conf")]),s._v(" 安装。")]),s._v(" "),e("li",[e("code",[s._v("mysqld_pre_systemd")]),s._v("（RPM 平台）、"),e("code",[s._v("mysql-system-start")]),s._v("（Debian 平台）：支持单元文件的脚本。只有当日志位置与模式匹配时，此脚本才有助于创建错误日志文件（对于 RPM 平台为 "),e("code",[s._v("/var/log/mysql*.log")]),s._v("，对于 Debian 平台为 "),e("code",[s._v("/var/log/mysql/*.log")]),s._v("）。在其他情况下，错误日志目录必须是可写的，或者对于运行 "),e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 进程的用户，错误日志必须存在且可写。")])]),s._v(" "),e("h2",{attrs:{id:"为-mysql-配置-systemd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为-mysql-配置-systemd"}},[s._v("#")]),s._v(" 为 MySQL 配置 systemd")]),s._v(" "),e("p",[s._v("要添加或更改MySQL的systemd选项，可以使用以下方法：")]),s._v(" "),e("ul",[e("li",[s._v("使用本地化的 systemd 配置文件。")]),s._v(" "),e("li",[s._v("安排 systemd 为 MySQL 服务器进程设置环境变量。")]),s._v(" "),e("li",[s._v("设置 "),e("code",[s._v("MYSQLD_OPTS")]),s._v(" systemd 变量。")]),s._v(" "),e("li",[s._v("要使用本地化的systemd配置文件，请创建 "),e("code",[s._v("/etc/systemd/system/mysqld.service.d")]),s._v(" 目录（如果不存在）。在该目录中，创建一个文件，其中包含列出所需设置的 "),e("code",[s._v("[Service]")]),s._v(" 部分。例如：")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LimitNOFILE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("max_open_files\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Nice")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nice_level\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LimitCore")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("core_file_limit\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LD_PRELOAD=/path/to/malloc/library"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TZ=time_zone_setting"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("此处的讨论使用 "),e("code",[s._v("override.conf")]),s._v(" 作为此文件的名称。较新版本的 systemd 支持以下命令，该命令将打开编辑器并允许你编辑文件：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl edit mysqld  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RPM platforms")]),s._v("\nsystemctl edit mysql   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Debian platforms")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("无论何时创建或更改 "),e("code",[s._v("override.conf")]),s._v("，重新加载 systemd 配置，然后告诉 systemd 重新启动 MySQL 服务：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl daemon-reload\nsystemctl restart mysqld  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RPM platforms")]),s._v("\nsystemctl restart mysql   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Debian platforms")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("对于 systemd，"),e("code",[s._v("override.conf")]),s._v(" 配置方法必须用于确定的参数，而不是 MySQL 选项文件中的 "),e("code",[s._v("[mysqld]")]),s._v("、"),e("code",[s._v("[mysqld_safe]")]),s._v(" 或 "),e("code",[s._v("[safe_mysqld]")]),s._v(" 组中的设置：")]),s._v(" "),e("ul",[e("li",[s._v("对于某些参数，必须使用 "),e("code",[s._v("override.conf")]),s._v("，因为 systemd 本身必须知道它们的值，又不能读取 MySQL 选项文件来获取它们。")]),s._v(" "),e("li",[s._v("指定值的参数只能使用 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 已知的选项设置，必须使用 systemd 指定，因为没有相应的 "),e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 参数。")])]),s._v(" "),e("p",[s._v("更多使用 systemd 而不是 mysqld_safe 的信息，参阅"),e("RouterLink",{attrs:{to:"/2/2.5/2.5.9/using-systemd.html#从-mysqld-safe-迁移到-systemd"}},[s._v("从 mysqld_safe 迁移到 systemd")]),s._v("。")],1),s._v(" "),e("p",[s._v("你可以在 "),e("code",[s._v("override.conf")]),s._v(" 中设置以下参数：")]),s._v(" "),e("ul",[e("li",[s._v("要设置 MySQL 服务器可用的文件描述符数量，请在 "),e("code",[s._v("override.conf")]),s._v(" 中使用 "),e("code",[s._v("LimitNOFILE")]),s._v(" 而不是 "),e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 的 "),e("a",{attrs:{href:"/5/5.1/5.1.8/server-system-variables"}},[s._v("open_files_limit")]),s._v(" 系统变量，或者 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 的 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("--open-files_limit")]),s._v(" 选项。")]),s._v(" "),e("li",[s._v("要设置最大核心文件大小，请在 "),e("code",[s._v("override.conf")]),s._v(" 中使用 "),e("code",[s._v("LimitCore")]),s._v("，而不是 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 的 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("--core-file-size")]),s._v(" 选项。")]),s._v(" "),e("li",[s._v("要设置 MySQL 服务器的调度优先级，请在 "),e("code",[s._v("override.conf")]),s._v(" 中使用 "),e("code",[s._v("Nice")]),s._v(" 而不是 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 的 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("--nice")]),s._v(" 选项。")])]),s._v(" "),e("p",[s._v("一些 MySQL 参数是使用环境变量配置的：")]),s._v(" "),e("ul",[e("li",[e("p",[e("code",[s._v("LD_PRELOAD")]),s._v("：如果 MySQL 服务器应该使用特定的内存分配库，则设置此变量。")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("NOTIFY_SOCKET")]),s._v("：此环境变量指定 "),e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 用于与 systemd 通信启动完成通知和服务状态更改通知的套接字。当 "),e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 服务启动时，它由 systemd 设置。"),e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 服务读取变量设置并写入定义的位置。")]),s._v(" "),e("p",[s._v("在 MySQL 8.0 中，"),e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 使用 "),e("code",[s._v("Type=notify")]),s._v(" 进程启动类型。（MySQL 5.7 中使用了 "),e("code",[s._v("Type=forking")]),s._v("。）使用 "),e("code",[s._v("Type=notify")]),s._v("，systemd 会自动配置套接字文件并将路径导出到 "),e("code",[s._v("NOTIFY_SOCKET")]),s._v(" 环境变量。")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("TZ")]),s._v("：设置此变量以指定服务器的默认时区。")])])]),s._v(" "),e("p",[s._v("有多种方法可以指定由 systemd 管理的 MySQL 服务器进程使用的环境变量值：")]),s._v(" "),e("ul",[e("li",[s._v("在 "),e("code",[s._v("override.conf")]),s._v(" 文件中使用 "),e("code",[s._v("Environment")]),s._v(" 线。有关语法，参阅前面讨论中描述如何使用此文件的示例。")]),s._v(" "),e("li",[s._v("在 "),e("code",[s._v("/etc/sysconfig/mysql")]),s._v(" 文件中指定值（如果文件不存在，则创建该文件）。使用以下语法分配值：")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LD_PRELOAD")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path/to/malloc/library\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TZ")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("time_zone_setting\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("修改 "),e("code",[s._v("/etc/sysconfig/mysql")]),s._v(" 后，重新启动服务器以使更改生效：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl restart mysqld  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RPM platforms")]),s._v("\nsystemctl restart mysql   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Debian platforms")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("要在不直接修改 systemd 配置文件的情况下为 "),e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 指定选项，请设置或取消设置 "),e("code",[s._v("MYSQLD_OPTS")]),s._v(" systemd 变量。例如：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl set-environment "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQLD_OPTS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--general_log=1"')]),s._v("\nsystemctl unset-environment MYSQLD_OPTS\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("也可以在 "),e("code",[s._v("/etc/sysconfig/mysql")]),s._v(" 文件中设置 "),e("code",[s._v("MYSQLD_OPTS")]),s._v("。\n修改 systemd 环境后，重新启动服务器以使更改生效：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl restart mysqld  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RPM platforms")]),s._v("\nsystemctl restart mysql   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Debian platforms")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("对于使用 systemd 的平台，如果服务器启动时数据目录为空，则会进行初始化。如果数据目录是暂时消失的远程装载，这可能是一个问题：装载点将显示为空数据目录，然后将其初始化为新的数据目录。要禁止这种自动初始化行为，请在 "),e("code",[s._v("/etc/sysconfig/mysql")]),s._v(" 文件中指定以下行（如果文件不存在，请创建该文件）：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NO_INIT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"使用-systemd-配置多个-mysql-实例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-systemd-配置多个-mysql-实例"}},[s._v("#")]),s._v(" 使用 systemd 配置多个 MySQL 实例")]),s._v(" "),e("p",[s._v("本节介绍如何为多个 MySQL 实例配置 systemd。")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("因为 systemd 能够在安装了 systemd 支持的平台上管理多个 MySQL 实例，即 "),e("a",{attrs:{href:"/4/4.3/4.3.4/mysqld-multi"}},[s._v("mysqld_multi")]),s._v(" 和 "),e("strong",[s._v("mysqld_multi.server")]),s._v(" 是不必要的，并且没有安装。")])]),s._v(" "),e("p",[s._v("要使用多实例功能，请修改 "),e("code",[s._v("my.cnf")]),s._v(" 选项文件以包括每个实例的键选项配置。这些文件位置是典型的：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("/etc/my.cnf")]),s._v(" 或 "),e("code",[s._v("/etc/mysql/my.conf")]),s._v("（RPM 平台）")]),s._v(" "),e("li",[e("code",[s._v("/etc/mysql/mysql.conf.d/mysqld.cnf")]),s._v("（Debian 平台）")])]),s._v(" "),e("p",[s._v("例如，要管理名为 "),e("code",[s._v("replica01")]),s._v(" 和 "),e("code",[s._v("replica02")]),s._v(" 的两个实例，请在选项文件中添加如下内容：")]),s._v(" "),e("p",[s._v("RPM 平台：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld@replica01"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("datadir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql-replica01\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socket")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql-replica01/mysql.sock\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v("\nlog-error"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/mysqld-replica01.log\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld@replica02"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("datadir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql-replica02\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socket")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql-replica02/mysql.sock\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3308")]),s._v("\nlog-error"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/mysqld-replica02.log\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("Debian 平台：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld@replica01"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("datadir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql-replica01\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socket")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql-replica01/mysql.sock\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v("\nlog-error"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/mysql/replica01.log\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld@replica02"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("datadir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql-replica02\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socket")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql-replica02/mysql.sock\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3308")]),s._v("\nlog-error"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/mysql/replica02.log\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("此处显示的副本名称使用 "),e("code",[s._v("@")]),s._v(" 作为分隔符，因为这是 systemd 支持的唯一分隔符。")]),s._v(" "),e("p",[s._v("然后，实例由正常的 systemd 命令管理，例如：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl start mysqld@replica01\nsystemctl start mysqld@replica02\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("要使实例在启动时运行，请执行以下操作：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" mysqld@replica01\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" mysqld@replica02\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("还支持使用通配符。例如，此命令显示所有复制副本实例的状态：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl status "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysqld@replica*'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("为了管理同一台机器上的多个 MySQL 实例，systemd 会自动使用不同的单元文件：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("mysqld@.service")]),s._v(" 而不是 "),e("code",[s._v("mysqld.service")]),s._v("（RPM 平台）")]),s._v(" "),e("li",[e("code",[s._v("mysql@.service")]),s._v(" 而不是 "),e("code",[s._v("mysql.service")]),s._v("（Debian 平台）")])]),s._v(" "),e("p",[s._v("在单元文件中，"),e("code",[s._v("%I")]),s._v(" 和 "),e("code",[s._v("%i")]),s._v(" 引用了在 "),e("code",[s._v("@")]),s._v(" 标记之后传入的参数，用于管理特定实例。对于这样的命令：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl start mysqld@replica01\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("systemd 使用以下命令启动服务器：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("mysqld --defaults-group-suffix"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("@%I "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("结果是 "),e("code",[s._v("[server]")]),s._v("、"),e("code",[s._v("[mysqld]")]),s._v(" 和 "),e("code",[s._v("[mysqld@replica01]")]),s._v(" 选项组被读取并用于该服务实例。")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("在 Debian 平台上，AppArmor 阻止服务器读取或写入 "),e("code",[s._v("/var/lib/mysql-replica*")]),s._v(" 或其他任何非默认位置。要解决此问题，必须在 "),e("code",[s._v("/etc/apparmor.d/usr.sbin.mysqld")]),s._v(" 中自定义或禁用配置文件。")])]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("在 Debian 平台上，MySQL 卸载的打包脚本当前无法处理 "),e("code",[s._v("mysqld@")]),s._v(" 实例。在删除或升级包之前，必须先手动停止任何额外的实例。")])]),s._v(" "),e("h2",{attrs:{id:"从-mysqld-safe-迁移到-systemd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从-mysqld-safe-迁移到-systemd"}},[s._v("#")]),s._v(" 从 mysqld_safe 迁移到 systemd")]),s._v(" "),e("p",[s._v("由于 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 未安装在使用 systemd 管理 MySQL 的平台上，因此之前为该程序指定的选项（例如，在 "),e("code",[s._v("[mysqld_safe]")]),s._v(" 或 "),e("code",[s._v("[safe_mysqld]")]),s._v(" 选项组中）必须以其他方式指定：")]),s._v(" "),e("ul",[e("li",[s._v("一些 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 选项也能被 "),e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 解读，可以从 "),e("code",[s._v("[mysqld_safe]")]),s._v(" 或 "),e("code",[s._v("[safe_mysqld]")]),s._v(" 选项组移动到 "),e("code",[s._v("[mysqld]")]),s._v(" 组。这"),e("em",[s._v("不")]),s._v("包括 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("--pid-file")]),s._v("、"),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("--open-files-limit")]),s._v(" 或 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("--nice")]),s._v("。要指定这些选项，请使用 "),e("code",[s._v("override.conf")]),s._v(" systemd文件，如前所述。")])]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("在 systemd 平台上，不支持使用 "),e("code",[s._v("[mysqld_safe]")]),s._v(" 和 "),e("code",[s._v("[safe_mysqld]")]),s._v(" 选项组，可能会导致意外行为。")])]),s._v(" "),e("ul",[e("li",[e("p",[s._v("对于一些 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 选项，有其他 "),e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 过程。例如，用于启用 "),e("code",[s._v("syslog")]),s._v(" 日志记录的 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 选项是 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("--syslog")]),s._v("，已弃用。要将错误日志输出写入系统日志，请使用"),e("a",{attrs:{href:"/5/5.4/5.4.2/5.4.2.8/error-log-syslog"}},[s._v("章节 5.4.2.8，“错误日志写入系统日志”")]),s._v("中的说明。")])]),s._v(" "),e("li",[e("p",[e("a",{attrs:{href:"/4/4.3/4.3.1/mysqld"}},[s._v("mysqld")]),s._v(" 无法解读的 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v(" 选项可以在 "),e("code",[s._v("override.conf")]),s._v(" 或环境变量中指定。例如，对于 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("mysqld_safe")]),s._v("，如果服务器应该使用特定的内存分配库，则使用 "),e("a",{attrs:{href:"/4/4.3/4.3.2/mysqld-safe"}},[s._v("--malloc-lib")]),s._v(" 选项指定。对于使用 systemd 管理服务器的安装，请按照前面所述安排设置 "),e("code",[s._v("LD_PRELOAD")]),s._v(" 环境变量。")])])]),s._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/using-systemd.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=r.exports}}]);