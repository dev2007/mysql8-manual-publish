(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{404:function(s,a,t){"use strict";t.r(a);var e=t(13),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_2-5-6-2-关于使用-docker-部署-mysql-服务的更多主题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-6-2-关于使用-docker-部署-mysql-服务的更多主题"}},[s._v("#")]),s._v(" 2.5.6.2 关于使用 Docker 部署 MySQL 服务的更多主题")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("以下大多数示例命令都将 "),a("code",[s._v("mysql/mysql-server")]),s._v(" 作为 Docker 镜像仓库（如 "),a("strong",[s._v("docker pull")]),s._v(" 和 "),a("strong",[s._v("docker run")]),s._v(" 命令）；如果你的镜像来自另一个仓库，请将其替换为 "),a("code",[s._v("container-registry.oracle.com/mysql/enterprise")]),s._v(" 服务器，用于从 Oracle 容器注册表（OCR）下载的 MySQL 企业版镜像，或从"),a("a",{attrs:{href:"https://support.oracle.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("我的 Oracle 支持"),a("OutboundLink")],1),s._v("下载的，用于 MySQL 企业版镜像的 "),a("code",[s._v("mysql/enterprise-server")]),s._v("。")])]),s._v(" "),a("ul",[a("li",[a("p",[a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#为-Docker-优化的-MySQL-安装"}},[s._v("为 Docker 优化的 MySQL 安装")])],1)]),s._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#配置-MySQL-服务器"}},[s._v("配置 MySQL 服务器")])],1)]),s._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#持久化数据和配置更改"}},[s._v("持久化数据和配置更改")])],1)]),s._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#运行其他初始化脚本"}},[s._v("运行其他初始化脚本")])],1)]),s._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#从另一个-Docker-容器应用连接到-MySQL"}},[s._v("从另一个 Docker 容器应用连接到 MySQL")])],1)]),s._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#服务器错误日志"}},[s._v("服务器错误日志")])],1)]),s._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#Docker-中使用-MySQL-企业备份"}},[s._v("Docker 中使用 MySQL 企业备份")])],1)]),s._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#Docker-中使用-mysqldump"}},[s._v("Docker 中使用 mysqldump")])],1)]),s._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#已知问题"}},[s._v("已知问题")])],1)]),s._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#Docker-环境变量"}},[s._v("Docker 环境变量")])],1)])]),s._v(" "),a("h2",{attrs:{id:"为-docker-优化的-mysql-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为-docker-优化的-mysql-安装"}},[s._v("#")]),s._v(" 为 Docker 优化的 MySQL 安装")]),s._v(" "),a("p",[s._v("针对 MySQL 的 Docker 镜像针对代码大小进行了优化，这意味着它们只包含与大多数在 Docker 容器中运行 MySQL 实例的用户相关的关键组件。MySQL Docker 安装与普通非 Docker 的安装在以下方面有所不同：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("包含的二进制文件限于：")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("/usr/bin/my_print_defaults")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/bin/mysql")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/bin/mysql_config")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/bin/mysql_install_db")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/bin/mysql_tzinfo_to_sql")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/bin/mysql_upgrade")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/bin/mysqladmin")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/bin/mysqlcheck")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/bin/mysqldump")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/bin/mysqlpump")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/bin/mysqlbackup")]),s._v(" (仅用于 MySQL 企业版 8.0 )")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/usr/sbin/mysqld")])])])])]),s._v(" "),a("li",[a("p",[s._v("所有二进制文件被剥离；它们不包含调试信息。")])])]),s._v(" "),a("h2",{attrs:{id:"配置-mysql-服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-mysql-服务器"}},[s._v("#")]),s._v(" 配置 MySQL 服务器")]),s._v(" "),a("p",[s._v("启动 MySQL Docker 容器时，可以通过 "),a("strong",[s._v("docker run")]),s._v(" 命令将配置选项传递给服务器。例如：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" mysql1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" mysql/mysql-server:tag --character-set-server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4 --collation-server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4_col\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("该命令启动 MySQL 服务器，将 "),a("code",[s._v("utf8mb4")]),s._v(" 作为默认字符集，并将 "),a("code",[s._v("utf8mb4_col")]),s._v(" 作为数据库的默认排序规则。")]),s._v(" "),a("p",[s._v("配置 MySQL 服务器的另一种方法是准备一个配置文件，并将其安装在容器中服务器配置文件的位置。有关详细信息，参阅"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#持久化数据和配置更改"}},[s._v("持久化数据和配置更改")]),s._v("。")],1),s._v(" "),a("h2",{attrs:{id:"持久化数据和配置更改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#持久化数据和配置更改"}},[s._v("#")]),s._v(" 持久化数据和配置更改")]),s._v(" "),a("p",[s._v("Docker 容器原则上是短暂的，如果容器被删除或损坏，任何数据或配置都将丢失（参阅此处的"),a("a",{attrs:{href:"https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/",target:"_blank",rel:"noopener noreferrer"}},[s._v("讨论"),a("OutboundLink")],1),s._v("）。"),a("a",{attrs:{href:"https://docs.docker.com/engine/admin/volumes/volumes/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 卷"),a("OutboundLink")],1),s._v("提供了一种持久化 Docker 容器内创建的数据的机制。在初始化时，MySQL 服务器容器为服务器数据目录创建一个 Docker 卷。容器上 "),a("strong",[s._v("docker inspect")]),s._v(" 命令的 JSON 输出包括一个 "),a("code",[s._v("Mount")]),s._v(" 键，其值提供数据目录卷的信息：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect mysql1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mounts"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"volume"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4f2d463cfc4bdd4baebcb098c97d7da3337195ed2c6572bc0b89f7e845d27652"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Source"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/volumes/4f2d463cfc4bdd4baebcb098c97d7da3337195ed2c6572bc0b89f7e845d27652/_data"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Destination"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/mysql"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mode"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RW"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Propagation"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("输出显示源目录 "),a("code",[s._v("/var/lib/docker/volumes/4f2d463cfc4bdd4baebcb098c97d7da3337195ed2c6572bc0b89f7e845d27652/_data")]),s._v("（其中数据保存在主机上）已安装在容器内的服务器数据目录 "),a("code",[s._v("/var/lib/mysql")]),s._v("。")]),s._v(" "),a("p",[s._v("另一种保存数据的方法是在创建容器时使用 "),a("code",[s._v("--mount")]),s._v(" 选项绑定挂载主机目录。可以使用相同的技术来持久化服务器的配置。以下命令创建一个 MySQL 服务器容器，并绑定数据目录和服务器配置文件：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/my.cnf,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/datadir,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" mysql/mysql-server:tag\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("该命令在 "),a("code",[s._v("/etc/my.cnf")]),s._v("（容器内的服务器配置文件）处挂载 "),a("code",[s._v("path-on-host-machine/my.cnf")]),s._v("，并在主机 "),a("code",[s._v("/datadir/var/lib/mysql")]),s._v("（容器内数据目录）上挂载 "),a("code",[s._v("path-on-host-machine/datadir")]),s._v("。绑定挂载工作必须满足以下条件：")]),s._v(" "),a("ul",[a("li",[s._v("配置文件 "),a("code",[s._v("path-on-host-machine/my.cnf")]),s._v(" 必须已经存在，并且必须包含用户 "),a("code",[s._v("mysql")]),s._v(" 启动服务器的规范：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("你还可以在文件中包含其他服务器配置选项。")]),s._v(" "),a("ul",[a("li",[s._v("数据目录 "),a("code",[s._v("path-on-host-machine/datadir")]),s._v(" 必须已经存在。要进行服务器初始化，目录必须为空。你还可以挂载预先填充了数据的目录，并用它启动服务器；但是，你必须确保使用与创建数据的服务器相同的配置启动 Docker 容器，并且在启动容器时安装所需的任何主机文件或目录。")])]),s._v(" "),a("h2",{attrs:{id:"运行其他初始化脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行其他初始化脚本"}},[s._v("#")]),s._v(" 运行其他初始化脚本")]),s._v(" "),a("p",[s._v("如果有任何 "),a("code",[s._v(".sh")]),s._v(" 或 "),a("code",[s._v(".sql")]),s._v(" 脚本要在创建后立即在数据库上运行，则可以将它们放入主机目录中，然后将目录挂载到容器中的 "),a("code",[s._v("/docker-entrypoint-initdb.d/")]),s._v(" 位置。例如：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/scripts/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/docker-entrypoint-initdb.d/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" mysql/mysql-server:tag\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"从另一个-docker-容器应用连接到-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从另一个-docker-容器应用连接到-mysql"}},[s._v("#")]),s._v(" 从另一个 Docker 容器应用连接到 MySQL")]),s._v(" "),a("p",[s._v("通过设置 Docker 网络，你可以允许多个 Docker 容器相互通信，以便另一个 Docker 容器中的客户端应用程序可以访问服务器容器中的 MySQL 服务器。首先，创建 Docker 网络：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network create my-custom-net\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后，在创建和启动服务器和客户机容器时，使用 "),a("code",[s._v("--network")]),s._v(" 选项将它们放在你创建的网络上。例如：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-custom-net "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" mysql/mysql-server\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myapp1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-custom-net "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" myapp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后，"),a("code",[s._v("myapp1")]),s._v(" 容器可以使用 "),a("code",[s._v("mysql1")]),s._v(" 主机名连接到 "),a("code",[s._v("mysql1")]),s._v(" 容器，反之亦然，因为 Docker 会自动为给定的容器名称设置 DNS。在下面的示例中，我们从 "),a("code",[s._v("myapp1")]),s._v(" 容器内部运行 "),a("RouterLink",{attrs:{to:"/4/4.5/4.5.1/mysql.html"}},[s._v("mysql")]),s._v(" 客户端，以连接到自己容器中的主机 "),a("code",[s._v("mysql1")]),s._v("：")],1),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" myapp1 mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myuser "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("有关容器的其他网络技术，参阅 Docker 文档中的 "),a("a",{attrs:{href:"https://docs.docker.com/engine/userguide/networking/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 容器网络"),a("OutboundLink")],1),s._v("部分。")]),s._v(" "),a("h2",{attrs:{id:"服务器错误日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器错误日志"}},[s._v("#")]),s._v(" 服务器错误日志")]),s._v(" "),a("p",[s._v("当使用服务器容器首次启动 MySQL 服务器时，如果以下任一条件为真，则不会生成服务器错误日志：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("已装载主机的服务器配置文件，但该文件不包含系统变量 "),a("RouterLink",{attrs:{to:"/5/5.1/5.1.8/server-system-variables.html"}},[s._v("log_error")]),s._v("（参阅绑定装载服务器配置文件时的"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#持久化数据和配置更改"}},[s._v("持久数据和配置更改")]),s._v("）。")],1)]),s._v(" "),a("li",[a("p",[s._v("来自主机的服务器配置文件尚未挂载，但 Docker 环境变量 "),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#Docker-环境变量"}},[s._v("MYSQL_LOG_CONSOLE")]),s._v(" 为true（这是 MYSQL 8.0 服务器容器的默认状态）。然后，MySQL 服务器的错误日志被重定向到 stderr，以便错误日志进入 Docker 容器的日志，并可以使用 "),a("code",[s._v("docker logs mysqld-container")]),s._v(" 容器命令查看。")],1)])]),s._v(" "),a("p",[s._v("要使 MySQL 服务器在这两个条件之一为真时生成错误日志，请使用 "),a("RouterLink",{attrs:{to:"/5/5.1/5.1.7/server-options.html"}},[s._v("--log-error")]),s._v(" 选项将"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#配置-MySQL-服务器"}},[s._v("配置服务器")]),s._v("为在容器内的特定位置生成错误日志。要持久化错误日志，请在容器内的错误日志位置安装主机文件，如"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#持久化数据和配置更改"}},[s._v("持久数据和配置更改")]),s._v("中所述。但是，你必须确保容器中的 MySQL 服务器对装载的主机文件具有写访问权限。")],1),s._v(" "),a("h2",{attrs:{id:"docker-中使用-mysql-企业备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-中使用-mysql-企业备份"}},[s._v("#")]),s._v(" Docker 中使用 MySQL 企业备份")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://dev.mysql.com/doc/mysql-enterprise-backup/8.0/en/",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL 企业备份"),a("OutboundLink")],1),s._v("是 MySQL 服务器的商业授权备份实用程序，可与 "),a("a",{attrs:{href:"https://dev.mysql.com/doc/mysql-enterprise-backup/8.0/en/",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL 企业版"),a("OutboundLink")],1),s._v("一起使用。MySQL 企业备份包含在 MySQL 企业版的 Docker 安装中。")]),s._v(" "),a("p",[s._v("在下面的示例中，我们假设你已经在 Docker 容器中运行了 MySQL 服务器（参阅"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.1/docker-mysql-getting-started.html"}},[s._v("章节 2.5.6.1，“使用 Docker 部署 MySQL 服务器的基本步骤”")]),s._v("，了解如何使用 Docker 启动 MySQL 服务器实例）。为了使 MySQL 企业备份能够备份 MySQL 服务器，它必须能够访问服务器的数据目录。例如，可以通过在启动服务器时"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#持久化数据和配置更改"}},[s._v("将主机目录绑定到 MySQL 服务器的数据目录")]),s._v("来实现：")],1),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysqlserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/datadir/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" mysql/enterprise-server:8.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("使用此命令，MySQL 服务器将使用 MySQL 企业版的 Docker 镜像启动，主机目录 "),a("em",[s._v("/path-on-host-machine/datadir/")]),s._v(" 已安装到服务器容器内的服务器数据目录（"),a("code",[s._v("/var/lib/mysql")]),s._v("）。我们还假设，在服务器启动后，还为 MySQL 企业备份设置了访问服务器所需的权限（有关详细信息，参阅"),a("a",{attrs:{href:"/4/4.1/4.1.2/mysqlbackup.privileges"}},[s._v("向备份管理员授予 MySQL 权限")]),s._v("）。使用以下步骤备份和恢复 MySQL 服务器实例。")]),s._v(" "),a("p",[s._v("要使用 Docker 中使用 MySQL 企业备份在 Docker 容器中运行的 MySQL 服务器实例，请执行以下步骤：")]),s._v(" "),a("ol",[a("li",[s._v("在运行 MySQL 服务器容器的同一主机上，使用 MySQL 企业版的镜像启动另一个容器，以使用 MySQL 企业备份命令 "),a("a",{attrs:{href:"/19/19.1/backup-commands-backup"}},[s._v("backup-to-image")]),s._v(" 执行备份。使用我们在上一步中创建的绑定挂载提供对服务器数据目录的访问。此外，将主机目录（在本例中为 "),a("code",[s._v("/path-on-host-machine/backups/")]),s._v("）挂载到容器中的备份存储文件夹（在本示例中为 "),a("code",[s._v("/data/backups")]),s._v("），以持久化我们正在创建的备份。以下是此步骤的示例命令，其中 MySQL 企业备份使用从"),a("a",{attrs:{href:"https://support.oracle.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("我的 Oracle 支持"),a("OutboundLink")],1),s._v("下载的 Docker 镜像启动）：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/datadir/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/backups/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/backups "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" mysql/enterprise-server:8.0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\nmysqlbackup "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-umysqlbackup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ppassword")]),s._v(" --backup-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/backup-tmp --with-timestamp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--backup-image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/backups/db.mbi backup-to-image\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Entrypoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" MySQL Docker Image "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".11-1.1.5\nMySQL Enterprise Backup version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".11 Linux-4.1.12-61.1.16.el7uek.x86_64-x86_64 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-04-08  07:06:45"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCopyright "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2003")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(", Oracle and/or its affiliates. All Rights Reserved.\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":27:25 MAIN    INFO: A thread created with Id "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'140594390935680'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":27:25 MAIN    INFO: Starting with following "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" line "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n-------------------------------------------------------------\n   Parameters Summary\n-------------------------------------------------------------\n   Start LSN                  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29615616")]),s._v("\n   End LSN                    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29651854")]),s._v("\n-------------------------------------------------------------\n\nmysqlbackup completed OK"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("重要的是检查 "),a("strong",[s._v("mysqlbackup")]),s._v(" 输出的结尾，以确保备份已成功完成。")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("一旦备份作业完成，容器就会退出，并且使用 "),a("code",[s._v("--rm")]),s._v(" 选项启动它，容器在退出后就会被删除。镜像备份已经创建，可以在上一步挂载的用于保存备份的主机目录中找到，如下所示:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /tmp/backups\ndb.mbi\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("要在 Docker 容器中使用 MySQL 企业版备份恢复 MySQL 服务器实例，请遵循下面列出的步骤:")]),s._v(" "),a("ol",[a("li",[s._v("停止 MySQL 服务器容器，它也会停止 MySQL 服务器运行:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop mysqlserver\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("在主机上，删除 MySQL 服务器数据目录的绑定挂载中的所有内容:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /path-on-host-machine/datadir/*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("启动一个带有 MySQL 企业版镜像的容器，使用 MySQL 企业版备份命令 "),a("a",{attrs:{href:"/19/19.3/backup-commands-restore"}},[s._v("copy-back-apply-log")]),s._v(" 执行恢复。绑定挂载服务器的数据目录和备份的存储文件夹，就像我们备份服务器时所做的那样:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/datadir/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/backups/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/backups "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" mysql/enterprise-server:8.0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\nmysqlbackup --backup-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/backup-tmp --with-timestamp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--datadir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql --backup-image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/backups/db.mbi copy-back-and-apply-log\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Entrypoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" MySQL Docker Image "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".11-1.1.5\nMySQL Enterprise Backup version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".11 Linux-4.1.12-61.1.16.el7uek.x86_64-x86_64 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-04-08  07:06:45"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCopyright "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2003")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(", Oracle and/or its affiliates. All Rights Reserved.\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":06:52 MAIN    INFO: A thread created with Id "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'139768047519872'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":06:52 MAIN    INFO: Starting with following "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" line "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":06:52 PCR1    INFO: We were able to parse ibbackup_logfile up to\n          lsn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29680612")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":06:52 PCR1    INFO: Last MySQL binlog "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" position "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("155")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" name binlog.000003\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":06:52 PCR1    INFO: The first data "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" is "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/var/lib/mysql/ibdata1'")]),s._v("\n                              and the new created log files are at "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/var/lib/mysql'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":06:52 MAIN    INFO: No Keyring "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" to process.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":06:52 MAIN    INFO: Apply-log operation completed successfully.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180921")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":06:52 MAIN    INFO: Full Backup has been restored successfully.\n\nmysqlbackup completed OK"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" with "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" warnings\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("一旦备份作业完成，容器就会退出，并且在启动它时使用 "),a("code",[s._v("--rm")]),s._v(" 选项，它会在退出后被删除。")]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("重启服务器容器，服务器容器也会重启恢复的服务器，可以使用以下命令:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart mysqlserver\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("或者，在恢复的数据目录上启动一个新的 MySQL 服务器，如下所示:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysqlserver2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/datadir/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" mysql/enterprise-server:8.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"docker-中使用-mysqldump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-中使用-mysqldump"}},[s._v("#")]),s._v(" Docker 中使用 mysqldump")]),s._v(" "),a("p",[s._v("除了"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#Docker-中使用-MySQL-企业备份"}},[s._v("使用 MySQL 企业备份来备份运行在 Docker 容器中的 MySQL 服务器")]),s._v("，你还可以使用运行在 Docker 容器中的 "),a("a",{attrs:{href:"/4/4.5/4.5.4/mysqldump"}},[s._v("mysqldump")]),s._v(" 工具来对服务器进行逻辑备份。")],1),s._v(" "),a("p",[s._v("下面的说明假设你已经在 Docker 容器中运行了一个 MySQL 服务器，并且当容器第一次启动时，一个主机目录 "),a("em",[s._v("/path-on-host-machine/datadir/")]),s._v(" 已经挂载到服务器的数据目录 "),a("code",[s._v("/var/lib/mysql")]),s._v(" 上(详细信息参阅"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#持久化数据和配置更改"}},[s._v("在 MySQL 服务器的数据目录上绑定挂载一个主机目录")]),s._v(")，该目录包含Unix套接字文件，"),a("a",{attrs:{href:"/4/4.5/4.5.4/mysqldump"}},[s._v("mysqldump")]),s._v(" 和 "),a("a",{attrs:{href:"/4/4.5/4.5.1/mysql"}},[s._v("mysql")]),s._v(" 可以通过该套接字文件连接到服务器。我们还假设，在服务器启动之后，创建了一个具有适当权限的用户(在本例中为 "),a("code",[s._v("admin")]),s._v(")， mysqldump 可以通过该用户访问服务器。备份和恢复 MySQL 服务器数据的操作步骤如下:")],1),s._v(" "),a("p",[a("em",[s._v("在 Docker 中使用 "),a("a",{attrs:{href:"/4/4.5/4.5.4/mysqldump"}},[s._v("mysqldump")]),s._v(" 备份 MySQL 服务器数据:")])]),s._v(" "),a("ol",[a("li",[s._v("在 MySQL 服务器容器运行的同一台主机上，用 MySQL 服务器的镜像启动另一个容器，使用 "),a("a",{attrs:{href:"/4/4.5/4.5.4/mysqldump"}},[s._v("mysqldump")]),s._v(" 实用程序执行备份(有关其功能、选项和限制，参阅该实用程序的文档)。通过绑定挂载 "),a("em",[s._v("/path-on-host-machine/datadir/")]),s._v(" 提供对服务器数据目录的访问。另外，将一个主机目录(本例中为 "),a("em",[s._v("/path-on-host-machine/backups/")]),s._v(")挂载到容器内用于备份的存储文件夹上(本例中使用 "),a("code",[s._v("/data/backups")]),s._v(")，以持久化所创建的备份。下面是使用此设置备份服务器上所有数据库的示例命令:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--entrypoint")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/datadir/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/backups/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/backups "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" mysql/mysql-server:8.0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"mysqldump -uadmin --password='password' --all-databases > /data/backups/all-databases.sql\"")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("在该命令中，使用 "),a("code",[s._v("--entrypoint")]),s._v(" 选项，以便在容器启动后调用系统 shell，使用 "),a("code",[s._v("-c")]),s._v(" 选项指定要在 shell 中运行的 "),a("a",{attrs:{href:"/4/4.5/4.5.4/mysqldump"}},[s._v("mysqldump")]),s._v(" 命令，该命令的输出将被重定向到备份目录中的 "),a("code",[s._v("all-databases.sql")]),s._v("文件。")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("一旦备份作业完成，容器就会退出，并且使用 "),a("code",[s._v("--rm")]),s._v(" 选项启动它，容器在退出后就会被删除。创建了一个逻辑备份，可以在用于存储备份的挂载的主机目录中找到，如下所示:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /path-on-host-machine/backups/\nall-databases.sql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("em",[s._v("在 Docker 使用 "),a("a",{attrs:{href:"/4/4.5/4.5.4/mysqldump"}},[s._v("mysqldump")]),s._v(" 恢复 MySQL 服务器数据:")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("确保 MySQL 服务器在容器中运行，你希望将备份数据恢复到该容器上。")])]),s._v(" "),a("li",[a("p",[s._v("用 MySQL 服务器的镜像启动一个容器，用 MySQL 客户端执行恢复。绑定挂载服务器的数据目录，以及包含备份的存储文件夹:")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/datadir/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path-on-host-machine/backups/,dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/backups "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" mysql/mysql-server:8.0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\nmysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uadmin")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source /data/backups/all-databases.sql"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("一旦备份任务完成，容器就退出，并且在启动它时使用 "),a("code",[s._v("--rm")]),s._v(" 选项，在它退出后将其删除。")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("登录到服务器，检查恢复的数据现在已经在服务器上。")])]),s._v(" "),a("h2",{attrs:{id:"已知问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#已知问题"}},[s._v("#")]),s._v(" 已知问题")]),s._v(" "),a("p",[s._v("当使用服务器系统变量 "),a("a",{attrs:{href:"/6/6.4/6.4.5/6.4.5.11/audit-log-reference"}},[s._v("audit_log_file")]),s._v("配置审计日志文件名时，使用 "),a("code",[s._v("loose")]),s._v(" "),a("a",{attrs:{href:"/4/4.2/4.2.2/4.2.2.4/option-modifiers"}},[s._v("选项修饰符")]),s._v(";否则，Docker 无法启动服务器。")]),s._v(" "),a("h2",{attrs:{id:"docker-环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-环境变量"}},[s._v("#")]),s._v(" Docker 环境变量")]),s._v(" "),a("p",[s._v("当你创建 MySQL 服务器容器时，你可以使用 "),a("code",[s._v("--env")]),s._v(" 选项(简写形式 "),a("code",[s._v("-e")]),s._v(")并指定一个或多个环境变量来配置 MySQL 实例。如果挂载的数据目录不为空，则不执行服务器初始化，在这种情况下，设置任何这些变量都不起作用(参阅"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#持久化数据和配置更改"}},[s._v("持久化数据和配置更改")]),s._v(")，并且在容器启动期间不会修改目录的现有内容(包括服务器设置)。")],1),s._v(" "),a("p",[s._v("可以用来配置 MySQL 实例的环境变量如下:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("布尔变量包括 "),a("code",[s._v("MYSQL_RANDOM_ROOT_PASSWORD")]),s._v("、"),a("code",[s._v("[")]),s._v("MYSQL_ONETIME_PASSWORD"),a("code",[s._v("、")]),s._v("MYSQL_ALLOW_EMPTY_PASSWORD"),a("code",[s._v("和")]),s._v("MYSQL_LOG_CONSOLE` 通过使用任何非零长度的字符串来设置它们，使其为真。因此，将它们设置为“0”、“false” 或 “no” 并不会使它们为假，而是实际上使它们为真。这是一个众所周知的问题。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("MYSQL_RANDOM_ROOT_PASSWORD")]),s._v("：当该变量为 true(这是它的默认状态，除非 "),a("code",[s._v("MYSQL_ROOT_PASSWORD")]),s._v(" 被设置或 "),a("code",[s._v("MYSQL_ALLOW_EMPTY_PASSWORD")]),s._v(" 被设置为 true)时，在 Docker 容器启动时为服务器的 root 用户生成一个随机密码。密码被打印到容器的 "),a("code",[s._v("stdout")]),s._v("，可以通过查看容器的日志找到(参阅[启动 MySQL 服务器实例](/2/2.5/2.5.6/2.5.6.2/docker-mysql-getting-started.html#启动 MySQL 服务器实例))。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("MYSQL_ONETIME_PASSWORD")]),s._v("：当变量为 true(这是它的默认状态，除非 "),a("code",[s._v("MYSQL_ROOT_PASSWORD")]),s._v(" 被设置或 "),a("code",[s._v("MYSQL_ALLOW_EMPTY_PASSWORD")]),s._v(" 被设置为 true)时，root 用户的密码被设置为过期，必须修改后 MySQL 才能正常使用。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("MYSQL_DATABASE")]),s._v("：这个变量允许你指定要在镜像启动时创建的数据库的名称。如果 "),a("code",[s._v("MYSQL_USER和MYSQL_PASSWORD")]),s._v(" 提供了用户名和密码，则创建该用户并授予对该数据库的超级用户访问权(对应于 "),a("code",[s._v("GRANT ALL")]),s._v(")。指定的数据库是通过 "),a("a",{attrs:{href:"/13/13.1/13.1.12/create-database"}},[s._v("CREATE database IF NOT EXIST")]),s._v(" 语句创建的，因此如果数据库已经存在，则该变量将不起作用。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("MYSQL_USER")]),s._v("、"),a("code",[s._v("MYSQL_PASSWORD")]),s._v("：这些变量一起用来创建一个用户并设置该用户的密码，并且该用户被授予 "),a("code",[s._v("MYSQL_DATABASE")]),s._v(" 变量指定的数据库的超级用户权限。要创建用户，"),a("code",[s._v("MYSQL_USER")]),s._v(" 和 "),a("code",[s._v("MYSQL_PASSWORD")]),s._v(" 都是必需的——如果没有设置这两个变量中的任何一个，则忽略另一个。如果两个变量都设置了，但 "),a("code",[s._v("MYSQL_DATABASE")]),s._v(" 没有设置，则创建的用户没有任何特权。")])])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("不需要使用这种机制来创建 root 超级用户，默认情况下创建 root 超级用户时使用的密码由 "),a("code",[s._v("MYSQL_ROOT_PASSWORD")]),s._v(" 和 "),a("code",[s._v("MYSQL_RANDOM_ROOT_PASSWORD")]),s._v(" 描述中讨论的任何一种机制设置，除非 "),a("code",[s._v("MYSQL_ALLOW_EMPTY_PASSWORD")]),s._v(" 为 true。")])]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("MYSQL_ROOT_HOST")]),s._v("：默认情况下，MySQL 创建 "),a("code",[s._v("'root'@'localhost'")]),s._v(" 帐户。该帐户只能从容器内连接，如"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#从另一个-Docker-容器应用连接到-MySQL"}},[s._v("从容器内连接 MySQL 服务器")]),s._v("中所述。若要允许来自其他主机的 root 连接，请设置此环境变量。例如，值 "),a("code",[s._v("172.17.0.1")]),s._v(" 是默认的 Docker 网关 IP，它允许来自运行容器的主机的连接。该选项只接受一个条目，但是允许通配符(例如，"),a("code",[s._v("MYSQL_ROOT_HOST=172.*.*.*")]),s._v(" 或 "),a("code",[s._v("MYSQL_ROOT_HOST=%")]),s._v(")。")],1)]),s._v(" "),a("li",[a("p",[a("code",[s._v("MYSQL_LOG_CONSOLE")]),s._v("：当变量为 true 时(这是 MySQL 8.0 服务器容器的默认状态)，MySQL 服务器的错误日志被重定向到 stderr，这样错误日志就会进入 Docker 容器的日志中，并且可以使用 "),a("strong",[s._v("docker logs")]),s._v(" "),a("em",[s._v("mysqld-container")]),s._v(" 命令查看。")])])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("如果已经挂载了来自主机的服务器配置文件，则该变量将不起作用(参阅在绑定挂载配置文件时"),a("RouterLink",{attrs:{to:"/2/2.5/2.5.6/2.5.6.2/docker-mysql-more-topics.html#持久化数据和配置更改"}},[s._v("持久化数据和配置更改")]),s._v(")。")],1)]),s._v(" "),a("ul",[a("li",[a("code",[s._v("MYSQL_ROOT_PASSWORD")]),s._v("：该变量指定为 MySQL root 帐户设置的密码。")])]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("警告")]),s._v(" "),a("p",[s._v("在命令行设置 MySQL root用户密码是不安全的。作为显式指定密码的替代方法，你可以使用密码文件的容器文件路径设置变量，然后在容器文件路径上挂载主机上包含密码的文件。这仍然不是很安全，因为密码文件的位置仍然暴露在外。最好使用 "),a("code",[s._v("MYSQL_RANDOM_ROOT_PASSWORD")]),s._v(" 和 "),a("code",[s._v("MYSQL_ONETIME_PASSWORD")]),s._v(" 的默认设置都为 true。")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("MYSQL_ALLOW_EMPTY_PASSWORD")]),s._v("。将其设置为 true 将允许容器以 root 用户的空密码启动。")])]),s._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/docker-mysql-more-topics.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);